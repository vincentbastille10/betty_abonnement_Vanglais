{% extends "base.html" %}
{% block content %}

{# Hide the "‚ú® Betty Bots" title that might come from the base layout #}
<style>
  header h1:first-child {
    display: none;
  }
</style>

<!-- Spectra Media + Betty Bots logos (large version) -->
<div style="display:flex;justify-content:center;align-items:center;gap:40px;margin:24px 0 8px;">
  <img src="{{ url_for('static', filename='spectra_media_logo.png') }}"
       alt="Spectra Media"
       style="height:120px;object-fit:contain;">
  <img src="{{ url_for('static', filename='logo-bettybots.png') }}"
       alt="Betty Bots"
       style="height:120px;object-fit:contain;">
</div>

<h1>Meet Betty Bots</h1>
<p class="intro">
  The next-generation, profession-focused chatbot that <strong>captures your clients 24/7</strong> with a <strong>specialized AI</strong>.
  Integration in <strong>2 minutes</strong> on your website. Save time and never miss an opportunity again.
</p>

<!-- CTA block: centered column -->
<div class="hero-cta"
     style="display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:4px;">

  <p class="trial-note" style="max-width:520px;margin:0;text-align:center;font-size:15px;opacity:.88;">
    No risk: try Betty for <strong>7 days for free</strong>, then decide if you want to keep it.
  </p>

  <!-- 7-day free trial button -> goes to configuration page -->
  <a href="{{ url_for('config_page') }}"
     class="btn primary big"
     style="display:inline-block;margin:0 auto;">
    Try Betty free for 7 days
  </a>

</div>

<!-- üîµ ‚ÄúSite √† 1‚Ç¨‚Äù button -->
<div style="margin-top:20px; text-align:center;">
  <a href="https://sitea1euro.vercel.app/"
     style="
       display:inline-block;
       padding:14px 28px;
       background:linear-gradient(90deg,#3b82f6,#2563eb,#1e40af);
       border-radius:999px;
       color:#f8fafc;
       font-weight:600;
       font-size:16px;
       text-decoration:none;
       box-shadow:0 0 22px rgba(37,99,235,0.6);
       margin-top:10px;
     ">
    No website yet? Add ‚Ç¨1 and get a professional website
  </a>
  <p style="font-size:12px;opacity:.7;margin-top:6px;">
    Automatic launch after payment ‚Ä¢ No long-term commitment
  </p>
</div>

<!-- Trust band -->
<div class="trust">
  <div>‚úì Secure Stripe payment</div>
  <div>‚úì Data handled confidentially</div>
  <div>‚úì Cancel anytime</div>
</div>

<!-- Key points -->
<div class="features">
  <div class="feature">
    <h3>Automatic lead qualification</h3>
    <p>Name, email, phone, reason‚Ä¶ Betty collects the essentials without friction and sends you ready-to-call leads.</p>
  </div>
  <div class="feature">
    <h3>Profession-specific AI</h3>
    <p>Answers adapted to your activity (lawyer, doctor, real estate, notary, craftsman, etc.), with a tone customizable to your brand.</p>
  </div>
  <div class="feature">
    <h3>Plug &amp; play</h3>
    <p>Just copy a simple script. Color, avatar, welcome message, contact details: everything is set up in a few clicks.</p>
  </div>
</div>

<!-- Metrics band -->
<div class="metrics">
  <div class="metric">
    <div class="m-num">+120</div>
    <div class="m-label">qualified conversations / month</div>
  </div>
  <div class="metric">
    <div class="m-num">-35%</div>
    <div class="m-label">time spent on the phone</div>
  </div>
  <div class="metric">
    <div class="m-num">4.8‚òÖ</div>
    <div class="m-label">average visitor satisfaction</div>
  </div>
</div>

<!-- Testimonials -->
<div class="testimonials">
  <div class="t-card">
    <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    <p class="t-quote">‚ÄúBetty filters incoming requests and prepares our files. We save a huge amount of time and only call back real prospects.‚Äù</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-avocat.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">Me Lef√®vre</div>
        <div class="t-role">Law firm ‚Äì Le Mans</div>
      </div>
    </div>
  </div>

  <div class="t-card">
    <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    <p class="t-quote">‚ÄúIt was live in 2 minutes. Patients find it clear, and we receive requests that are already qualified.‚Äù</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-medecin.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">Dr Martin</div>
        <div class="t-role">Medical practice ‚Äì Sarthe</div>
      </div>
    </div>
  </div>

  <div class="t-card">
    <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
    <p class="t-quote">‚ÄúLeads are more precise, less back-and-forth. Viewings are smoother and it shows in our numbers.‚Äù</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-immo.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">R. Dubois</div>
        <div class="t-role">Real estate agency ‚Äì Pays de la Loire</div>
      </div>
    </div>
  </div>
</div>

<!-- Trustpilot badge -->
<div class="trustpilot">
  <a href="#" rel="nofollow noopener">
    <img src="{{ url_for('static', filename='trustpilot-badge.png') }}" alt="Trustpilot" onerror="this.style.display='none'">
    <span>Verified ratings and reviews on Trustpilot</span>
  </a>
</div>

<!-- FAQ -->
<section class="faq">
  <h2>FAQ</h2>
  <div class="faq-list">
    <details>
      <summary>What‚Äôs the price and commitment?</summary>
      <div class="faq-body">
        ‚Ç¨29.99 / month, no commitment. You can cancel anytime from your account (secure Stripe payment).
      </div>
    </details>
    <details>
      <summary>How does Betty integrate with my website?</summary>
      <div class="faq-body">
        After payment, you get a <strong>unique script</strong> to copy-paste into your site (HTML / WordPress / Wix / Webflow‚Ä¶). Setup takes around 2 minutes.
      </div>
    </details>
    <details>
      <summary>Are my data protected?</summary>
      <div class="faq-body">
        Yes. Information is handled confidentially, never sold, and you remain the owner of your data. You can request deletion at any time.
      </div>
    </details>
    <details>
      <summary>Does Betty give legal / medical advice?</summary>
      <div class="faq-body">
        No. Betty <em>informs</em>, <em>guides</em>, and <em>qualifies</em> incoming requests. For any formal decision or opinion, she proposes an appointment with the professional.
      </div>
    </details>
  </div>
</section>

<!-- Live demo -->
<div id="demo" class="demo-frame" style="margin-top:26px">
  <div class="chat-frame" id="chat" style="display:flex;flex-direction:column;">
    <div style="padding:18px 16px 10px;border-bottom:1px solid var(--border);text-align:center">
      <img id="bot-avatar" src="" alt="Avatar"
           style="width:72px;height:72px;border-radius:999px;border:1px solid var(--border);background:#0b0f14;object-fit:cover;display:block;margin:0 auto 8px">
      <div id="bot-name" style="font-weight:700">Betty Bot (Spectra Media)</div>
    </div>

    <div id="messages" style="padding:16px;overflow:auto;flex:1;scroll-behavior:smooth">
      <div id="greet" class="bubble"
           style="max-width:280px;background:#111827;border:1px solid var(--border);border-radius:12px;padding:12px;margin:8px 0">
        Hi, I‚Äôm Betty. How can I help you today?
      </div>
    </div>

    <form id="form" style="padding:14px;border-top:1px solid var(--border);display:flex;gap:8px">
      <input id="input" type="text" placeholder="Type and press Enter‚Ä¶" autocomplete="off"
             style="background:#0b0f14;border:1px solid var(--border);border-radius:10px;color:var(--text);padding:12px;flex:1">
      <button class="btn" type="submit">Send</button>
    </form>
  </div>
</div>
<p class="trial-note" style="max-width:520px;margin:0 auto 12px;text-align:center;font-size:15px;opacity:.88;">
  Enjoy a <strong>7-day free trial</strong> before you commit.
</p>

<div class="hero-cta" style="margin-top:24px;text-align:center;">
  <a href="{{ url_for('config_page') }}"
     class="btn primary big"
     style="display:inline-block;margin:0 auto;">Create my bot now</a>
</div>
<div style="text-align:center;font-size:13px;opacity:.7;margin-top:4px;">
  Secure Stripe payment ‚Ä¢ No commitment ‚Ä¢ Cancel in one click
</div>
<div style="margin-top:40px;padding:20px 0;text-align:center;font-size:13px;opacity:.75;">
  <a href="mailto:spectramediabots@gmail.com"
     style="color:#8ab4ff;text-decoration:none;">
    üì© Contact ‚Äî Spectra Media AI
  </a>
</div>

<script>
  const botId = new URLSearchParams(location.search).get('bot_id') || 'spectra-demo';

  const avatarEl = document.getElementById('bot-avatar');
  const nameEl   = document.getElementById('bot-name');
  const greetEl  = document.getElementById('greet');
  const msgs     = document.getElementById('messages');
  const form     = document.getElementById('form');
  const input    = document.getElementById('input');

  // Smart focus: typing anywhere focuses the input (without initial autofocus)
  document.addEventListener('keydown', (e) => {
    const ign = ['Enter','Escape','Tab'];
    if (ign.includes(e.key)) return;
    if (document.activeElement !== input) {
      input.focus();
      if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
        e.preventDefault();
        input.value += e.key;
      }
    }
  });

  function scrollToBottom(){ msgs.scrollTop = msgs.scrollHeight; }

  // Bot meta
  fetch(`/api/bot_meta?bot_id=${encodeURIComponent(botId)}`)
    .then(r => r.json())
    .then(meta => {
      nameEl.textContent = meta.name || 'Betty';
      avatarEl.src = meta.avatar_url || '';
      if (meta.greeting) greetEl.textContent = meta.greeting;
      document.documentElement.style.setProperty('--primary', meta.color_hex || '#4F46E5');
      scrollToBottom();
    }).catch(()=>{});

  // Bubble
  function addBubble(text, mine=false){
    const div = document.createElement('div');
    div.className = 'bubble';
    div.style.maxWidth = '280px';
    div.style.border = '1px solid var(--border)';
    div.style.borderRadius = '12px';
    div.style.padding = '12px';
    div.style.margin = '8px 0';
    div.style.whiteSpace = 'pre-wrap';
    div.textContent = text;
    if(mine){ div.style.background='#1b2230'; div.style.marginLeft='auto'; }
    else    { div.style.background='#111827'; div.style.marginRight='auto'; }
    msgs.appendChild(div);
    scrollToBottom();
    return div;
  }

  // "Betty is typing‚Ä¶" loader
  function showTyping(){
    const t = document.createElement('div');
    t.className = 'bubble typing';
    t.style.maxWidth = '280px';
    t.style.border = '1px solid var(--border)';
    t.style.borderRadius = '12px';
    t.style.padding = '12px';
    t.style.margin = '8px 0';
    t.style.background = '#111827';
    t.style.marginRight = 'auto';
    t.innerHTML = '<span class="label">Betty is typing</span><span class="dots"><i></i><i></i><i></i></span>';
    msgs.appendChild(t);
    scrollToBottom();
    return t;
  }
  function hideTyping(el){ if(el && el.parentNode) el.parentNode.removeChild(el); }

  // Submit
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const text = input.value.trim();
    if(!text) return;
    addBubble(text, true);
    input.value = '';

    const typing = showTyping();
    try {
      const r = await fetch('/api/bettybot', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ message: text, bot_id: botId })
      });
      const j = await r.json();
      // Robust cleaning of technical tag (with or without </LEAD_JSON>)
      const cleaned = String(j.response ?? "")
        .replace(/\s*<LEAD_JSON>[\s\S]*?(?:<\/LEAD_JSON>|$)/g, "")
        .replace(/```[\s\S]*?```/g, "")
        .trim();

      addBubble(cleaned || "Sorry, something went wrong.");
      hideTyping(typing);

    } catch {
      hideTyping(typing);
      addBubble("Sorry, something went wrong.");
    }
  });
</script>
{% endblock %}
